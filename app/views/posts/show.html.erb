<div class="card mb-3 p-3">
  <div class="row no-gutters align-items-center">
    <div class="col-md-1 text-center">
        <div class="py-2">
            <% if @post.user.profile_image.attached? %>
                <%= image_tag(@post.user.profile_image, alt: @post.user.username, class: "rounded-circle", style: "height: 70px; width: 70px;") %>
            <% else %>
                <%= image_tag('default-profile.png', alt: 'Default profile', class: "rounded-circle", style: "height: 70px; width: 70px;") %>
            <% end %>
            <strong class="small"><%= @post.user.username %></strong>
        </div>
    </div>
    <div class="col-md-11">
      <div class="card-body">
        <h5 class="card-title"><%= @post.subject %></h5>
        <hr class="mt-2 mb-3">
        <p class="card-text"><%= @post.content %></p>
        <p class="card-text"><small class="text-muted">Last updated at: <%= @post.created_at.in_time_zone('Eastern Time (US & Canada)').strftime("%B %d, %Y at %I:%M %p") %></small></p>
      </div>
    </div>
  </div>
</div>

<div class="d-flex justify-content-end align-items-center">
  <div class="col-2" style="margin-right: -15px;">
    <%= link_to 'Back', posts_path, class: 'btn btn-light w-100' %>
  </div>
  <% if user_signed_in? && current_user.id == @post.user_id %>
    <div class="col-2">
        <%= form_with url: post_path(@post), method: :delete do %>
        <%= submit_tag 'Delete', data: { confirm: "Are you sure?" }, class: 'btn btn-danger w-100' %>
        <% end %>
    </div>
  <% end %>
</div>

<h3>Responses</h3>
<% @post.responses.each do |response| %>
  <div class="card mb-2">
    <div class="row no-gutters">
      <div class="col-md-2 d-flex align-items-center">
        <div class="p-2">
          <% if response.user.profile_image.attached? %>
            <%= image_tag(response.user.profile_image, alt: response.user.username, class: "rounded-circle", style: "height: 50px; width: 50px;") %>
          <% else %>
            <%= image_tag('default-profile.png', alt: 'Default profile', class: "rounded-circle", style: "height: 50px; width: 50px;") %>
          <% end %>
          <strong class="ml-2"><%= response.user.username %></strong>
        </div>
      </div>
      <div class="col-md-10">
        <div class="card-body">
          <p class="card-text"><%= response.content %></p>
        </div>
      </div>
    </div>
  </div>
<% end %>

<%= form_with(model: [ @post, Response.new ], local: true) do |form| %>
  <div class="form-group">
    <%= form.label :content, 'Your Response' %>
    <%= form.text_area :content, class: 'form-control' %>
  </div>
  <%= form.submit 'Submit Response', class: 'btn btn-primary' %>
<% end %>